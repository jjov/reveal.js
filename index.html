<!doctype html>
<html lang="En">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/league.css">
		<link rel="stylesheet" href="css/custom-macondo-styles.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<img src="/images/logo.png">
					<p class="demo-title">Demo</p>
				</section>
				<section>
					<h3><a>MAIN TOPICS</a></h3>
					<ol>
						<li>SPRINT AUTHENTICATION CHANGES FOR SOHO</li>
						<li>INSURE ERROR HANDLING REFACTORING</li>
					</ol>
				</section>
				<section>
					<section>
						<h3><a>SPRINT AUTHENTICATION CHANGES FOR SOHO</a></h3>
						<p>
							Basically it is a change in the SPRINT carrier side to support using alternative data as
							authentication mechanism
						</p>
					</section>
					<section>
						<h3><a>SPRINT APPROACH</a></h3>
						<img src="/images/sprint_approach.png" style="width: 600px;">
					</section>
					<section>
						<h3><a>Carrier APIs Affected</a></h3>
						<ul>
							<li><span class="highlighted-text">ValidateAccountInfo</span></li>
							<li><span class="highlighted-text">CheckCreditAndInitiateOrder</span></li>
							<li>LockRebateEligibility</li>
							<li>querySubscriberBasicServices</li>
						</ul>
					</section>
					<section>
						<h3><a>Request Carrier API</a></h3>
						<pre>
						<code class="hljs xml" data-trim data-line-numbers="12-19">
<wsMessageHeader>
	<trackingMessageHeader>
		<applicationId>AU2</applicationId>
		<applicationUserId>AU2</applicationUserId>
		<consumerId>apple</consumerId>
		<messageId>30489f50-7cf8-11e9-a283-0242ac120003</messageId>
		<conversationId>f1dfdf91-7e2b-4f9b-9057-0921fffa8bb0</conversationId>
		<timeToLive>120</timeToLive>
		<replyCompletionCode>0</replyCompletionCode>
		<messageDateTimeStamp>2019-05-23T01:15:12</messageDateTimeStamp>
	</trackingMessageHeader>
	<securityMessageHeader>
		<resourceCredentialInfo>
			<mdn>7407074726</mdn>
			<billingZipCode>42004</billingZipCode>
			<iccId>89011201000236190559</iccId>
			<pin>112235</pin>
		</resourceCredentialInfo>
	</securityMessageHeader>
	<callingApplicationInfo>
		<pin>7421</pin>
		<vendorCode>AP</vendorCode>
	</callingApplicationInfo>
</wsMessageHeader>
						</code>
					</pre>
						<p style="font-size: small;">MDN can be combined with <a>billingZipCode</a> or <a>iccId</a> or <a>pin</a></p>
					</section>
				</section>
				<section>
					<section>
						<h3><a>Solution</a></h3>
						<ul>
							<li>PAM will receive the customer information as part of the AccountLookup canonical
								request and send to the ESB the new fields as HTTP-Headers.</li>
							<li>ESB will process the HTTP-Headers received and create the MessageHeader as usual, but
								containing this time, the new <a>securitymessageheader</a> mentioned before </li>
						</ul>
					</section>
					<section>
						<h3><a>ESB Changes</a></h3>
						<ul>
							<li>WSDL and XSDs updated</li>
							<li>RAML & JSONSchemas updated</li>
							<li>ESB Mappings updated</li>
							<li>ESBGlobalCommon library was updated to receive the new HTTP-Headers send by PAM</li>
						</ul>
					</section>
					<section>
						<h3><a>PAM Changes</a></h3>
						<ul>
							<li>
								AccountLookup spec was updated
								<ul>
									<li>
										NetworkConnectionId was added to the request
									</li>
								</ul>
							</li>
							<li>ValidateAccountInfo and CheckCreditAndInitiateOrder Operations were generated</li>
							<li>Rest Agents updated to send the new HTTP-Headers to the ESB</li>
							<li>Backward compatibility through tenant preferences</li>
							<li>New Canonical Validations implemented for CreditCheck and AccountLookup</li>
						</ul>
					</section>
				</section>
				<section>
					<h3><a>Let's go to the code</a></h3>
				</section>
				<section>
					<h3><a>Challenges</a></h3>
					<ul>
						<li>
							SOHO support is given using a very old branch from the last mayor release (SOHO 28)
							<ul>
								<li>It does not support Wiremock so we have to deal with CR</li>
								<li>Switching between Target and SOHO is a pain as several configurations should be
									change in the ESB side</li>
							</ul>
						</li>
					</ul>
				</section>



				<section data-background="https://media.giphy.com/media/3otPoAb6YXPqt7ELrG/giphy.gif" data-background-size="800px"></section>


				<section>
            	<h3><a>INSURE ERROR HANDLING REFACTORING</a></h3>
            	When AppleCare Standalone activation was completed successfully, result field was not set.
            				<pre><code class="hljs javascript">
{
    "header": {
        "sessionId": "0b0d9374-8a45-424b-b98d-22f45fd3da7f",
        "clientReferenceId": "20311",
        "correlationId": "01a4b77b-5c72-11e9-bff9-0242ac130002"
    },
    "order": {
        "plans": [
            {
                "connections": [
                    {
                        "device": {
                            "serialNumber": "359031084298381",
                            "addOnServices": [
                                {
                                    "provider": "APPLECARE",
                                    "code": "junk",
                                    "accountNumber": "325513273087",
                                    "contract": {
                                        "data": "JVBERi0xLjQKJeLjz9HhyZWYKMjEzNwolJUVPRgo=",
                                        "MIMEtype": "Base64PDF"
                                    },
                                    "activationStatus": "COMPLETE"
                                }
                            ]
                        }
                    }
                ]
            },
            {
                "connections": [
                    {
                        "phoneNumber": "4042357027"
                    }
                ]
            }
        ]
    }
}
            </code></pre>
            		
        		</section>
				<section>
					<h3><a>Challenges during the implementation</a></h3>
					<ul>
						<li>Communication errors not supported for applecare. </li>
						<ul>
							<li>
								Did not set error object.
							</li>
							<li>
								Did not set Result as FAILURE.
							</li>
						</ul>
						<li>Error handling logic was executed always, even when a successful rest call.</li>
						<li>Some methods(scripts) does not respect Single Responsibility Principle.</li>
						<li>The same issues for other insurance providers.</li>
					</ul>
					
				</section>
				<section>
					<section>
					<h3><a>Actions</a></h3>
					<ul>
						<li>Carrier errors supported by PAM for AppleCare (SPIKE)</li>
						<ul>
							<li>
								AppleCare support 270 error codes.
							</li>
							<li>
								PAM support 110 of them with a Canonical Error. 
							</li>
							<li>
								PAM support 1 error code not currently supported by AppleCare.
							</li>
						</ul>
						<li>Define common error handling for each insurance provider, with communication error support.</li>
					</ul>
					</section>
					<section>
					<h3><a>Actions</a></h3>	
					<ul>
						<li>Split methods when does not respect Single Responsibility Principle.</li>
						<li>Implement success path, avoiding to run error handling logic when success.</li>
					</ul>
					</section>
				</section>
				<section>
					<h3><a>Let's go to the code</a></h3>
				</section>
				<section>
					<h3><a>Conclusions</a></h3>
					<ul>
						<li>Payment CR should be changed for wiremock.</li>
					</ul>
				</section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				transition: 'convex', // none/fade/slide/convex/concave/zoom
				dependencies: [
					{src: 'plugin/markdown/marked.js'},
					{src: 'plugin/markdown/markdown.js'},
					{src: 'plugin/notes/notes.js', async: true},
					{src: 'plugin/highlight/highlight.js', async: true},
					{ src: 'plugin/search/search.js', async: true },
					{ src: 'plugin/zoom-js/zoom.js', async: true }
				]
			});
		</script>
	</body>
</html>
